#!/usr/bin/env bash

# Update system branding
sed -i 's|^Manjaro Linux|BigCommunity|g' /etc/issue

# Update os-release
sed -i 's|^ *NAME *=.*|NAME="BigCommunity"|' /usr/lib/os-release
sed -i 's|^ *PRETTY_NAME *=.*|PRETTY_NAME="BigCommunity"|' /usr/lib/os-release
sed -i 's|^ *HOME_URL *=.*|HOME_URL="https://communitybig.org"|' /usr/lib/os-release
sed -i 's|^ *DOCUMENTATION_URL *=.*||' /usr/lib/os-release
sed -i 's|^ *SUPPORT_URL *=.*|SUPPORT_URL="https://t.me/BigLinuxCommunity"|' /usr/lib/os-release
sed -i 's|^ *LOGO *=.*|LOGO="comm-menu"|' /usr/lib/os-release
sed -i 's|^ *ID *=.*|ID="biglinux"|' /usr/lib/os-release
sed -i 's|^ *BUG_REPORT_URL *=.*|BUG_REPORT_URL="https://github.com/communitybig"|' /usr/lib/os-release
sed -i 's|^ *PRIVACY_POLICY_URL=.*||' /usr/lib/os-release

# Update lsb-release
sed -i 's|^DISTRIB_ID=.*|DISTRIB_ID="BigCommunity"|' /etc/lsb-release
sed -i 's|^DISTRIB_DESCRIPTION=.*|DISTRIB_DESCRIPTION="BigCommunity"|' /etc/lsb-release

# Create symlink for os-release
[[ -e /usr/lib/os-release ]] && ln -sf /usr/lib/os-release /etc/os-release

# Update GRUB configuration
sed -i 's|^GRUB_THEME=.*|GRUB_THEME="/boot/grub/themes/community/theme.txt"|' /etc/default/grub
sed -i 's|^GRUB_DISTRIBUTOR=.*|GRUB_DISTRIBUTOR="BigCommunity"|' /etc/default/grub

# Only update grub.cfg if system is installed (not live environment)
if [ -f /boot/grub/grub.cfg ]; then
    sed -i 's|BigCommunity Linux|BigCommunity|g' /boot/grub/grub.cfg
    if command -v update-grub &> /dev/null; then
        update-grub
    elif command -v grub-mkconfig &> /dev/null; then
        grub-mkconfig -o /boot/grub/grub.cfg
    fi
fi
